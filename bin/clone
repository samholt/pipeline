#!/usr/bin/env node

var fs = require("fs"),
    exec = require('child_process').execSync;

var posts = JSON.parse(fs.readFileSync("posts.json", "utf8")).posts;

try {
  fs.mkdirSync("posts");
} catch (e) {
  // posts folder already exists
}

//TODO: curl posts manifest from external repository into posts.csv or whatever
// https://raw.githubusercontent.com/distillpub/posts/master/posts.csv

posts.forEach(function(post) {
  var repoPath = "posts/" + post.githubRepo;
  try {
    // If repo already exists, just pull it
    fs.accessSync(repoPath, fs.F_OK);
    console.log("Pulling " + post.githubRepo);
    exec("git -C " + repoPath + " pull")
  } catch (e) {
    // Repo doesn't exist locally, so let's clone it
    exec("git clone --depth 1 " + "https://github.com/" + post.githubRepo + ".git" + " " + repoPath);
  }
});
